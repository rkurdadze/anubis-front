<div class="container-fluid py-4">
  <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mb-4">
    <div>
      <h1 class="h3 mb-1">Поиск по содержимому</h1>
      <p class="text-muted mb-0">Полнотекстовый поиск и управление переиндексацией контента</p>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary" type="button" (click)="reindexAll()" [disabled]="isReindexing">
        <i class="bi bi-arrow-clockwise me-1"></i>Переиндексация
      </button>
    </div>
  </div>

  <div *ngIf="message$ | async as message" class="alert" [ngClass]="message.type === 'success' ? 'alert-success' : 'alert-danger'">
    {{ message.text }}
  </div>

  <div class="row g-4">
    <div class="col-12 col-xl-5">
      <div class="card border-0 anubis-shadow h-100">
        <div class="card-header bg-white">
          <h2 class="h5 mb-0">Запрос</h2>
        </div>
        <div class="card-body">
          <form [formGroup]="searchForm" class="d-flex flex-column gap-3" (ngSubmit)="performSearch()">
            <div>
              <label class="form-label">Полнотекстовый запрос</label>
              <textarea class="form-control" rows="4" formControlName="query" placeholder="Введите ключевые слова"></textarea>
              <div class="form-text text-muted">Минимум 3 символа. Поддерживается автообновление результатов.</div>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="autoSearch" formControlName="auto" />
              <label class="form-check-label" for="autoSearch">Автоматически запускать поиск</label>
            </div>
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary flex-fill" [disabled]="isSearching">
                <i class="bi bi-search me-1"></i>Найти
              </button>
              <button type="button" class="btn btn-outline-secondary flex-fill" (click)="clearQuery()">
                Очистить
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-12 col-xl-7 mt-4 mt-xl-0">
      <div class="card border-0 anubis-shadow h-100">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h2 class="h5 mb-0">Результаты</h2>
          <span *ngIf="isSearching" class="spinner-border spinner-border-sm text-primary"></span>
        </div>
        <div class="list-group list-group-flush">
          <div class="list-group-item d-flex justify-content-between align-items-center small text-muted">
            Найдено версий: {{ (results$ | async)?.length ?? 0 }}
          </div>
          <div
            class="list-group-item d-flex justify-content-between align-items-center"
            *ngFor="let id of results$ | async; trackBy: trackById"
          >
            <div>
              <div class="fw-semibold">Версия #{{ id }}</div>
              <div class="text-muted small">Для получения данных откройте карточку объекта</div>
            </div>
            <button class="btn btn-outline-primary btn-sm" type="button" (click)="reindexVersion(id)" [disabled]="reindexVersionId === id">
              <i class="bi bi-arrow-repeat"></i>
            </button>
          </div>
          <div *ngIf="(results$ | async)?.length === 0" class="list-group-item text-center text-muted py-4">
            Введите запрос для поиска по OCR и текстовым документам.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
