<div class="filter-group" [class.child-group]="level > 0" [formGroup]="group">
  <!-- Заголовок группы -->
  <div class="filter-group__header">
    <div class="filter-group__header-left">
      <i class="fa-solid fa-code-branch me-1"></i>
      <span class="fw-semibold">Группа</span>
      <select class="form-select form-select-sm ms-2" formControlName="operator">
        <option value="AND">И</option>
        <option value="OR">ИЛИ</option>
      </select>
    </div>

    <div class="filter-group__header-actions">
      <button type="button" class="btn btn-outline-primary btn-sm" (click)="addCondition()">
        + Условие
      </button>
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="addGroup()">
        + Группа
      </button>
      <button *ngIf="level > 0" type="button" class="btn btn-outline-danger btn-sm" (click)="removeSelf(group.parent)">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
  </div>

  <!-- Список условий -->
  <div class="filter-group__conditions" formArrayName="conditions">
    <ng-container *ngIf="conditions && conditions.controls">
      <ng-container *ngFor="let cond of conditions.controls; index as i">
        <ng-container [formGroupName]="i">
          <ng-container *ngIf="isGroup(cond); else conditionBlock">
            <app-filter-group
              [group]="cond"
              [level]="level + 1"
              [propertyDefinitions]="propertyDefinitions"
              [operators]="operators">
            </app-filter-group>
          </ng-container>

          <ng-template #conditionBlock>
            <div class="filter-condition">
              <span class="filter-condition__number">#{{ i + 1 }}</span>

              <select class="form-select form-select-sm" formControlName="propertyDefId">
                <option [ngValue]="null" disabled selected>Свойство</option>
                <option *ngFor="let def of propertyDefinitions" [ngValue]="def.id">
                  {{ def.name }} · {{ propertyDataTypeLabels[def.dataType] }}
                </option>
              </select>

              <select class="form-select form-select-sm" formControlName="op">
                <option *ngFor="let o of operators" [value]="o.value">
                  {{ o.label }}
                </option>
              </select>

              <input class="form-control form-control-sm" formControlName="value" placeholder="Значение" />

              <button type="button" class="btn btn-outline-danger btn-sm" (click)="remove(i)">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </div>
          </ng-template>
        </ng-container>
      </ng-container>
    </ng-container>
  </div>
</div>
